# feedback response v2

## plan

checklist of changes:
- [ ] blocker 1: remove `stdout: 'ignore'` from append operations
- [ ] blocker 2: rename `formatDeclaredUnixHostAliasAsHostsLine` to `castFromDeclaredUnixHostAlias`
- [ ] blocker 3: create `castIntoDeclaredUnixHostAlias` from `OsUnixHostsFileLine`
- [ ] blocker 4: rename `OsUnixHostsFileEntry` to `OsUnixHostsFileLine`
- [ ] blocker 5: move OsUnix* operations to `access/sdks/osUnixHostsFile`
- [ ] blocker 6: apply same pattern to portAlias (`access/sdks/osUnixSystemdSocat`)
- [ ] update tests and run to verify

---

## execution

### blocker 1: remove stdout:'ignore' — failfast violation

**understood.**

removed `stdout: 'ignore'` from:
- `addOsUnixHostsFileLine` — now lets stdout through for failfast behavior
- `addOsUnixSystemdSocatService` — same

this ensures any write errors are surfaced immediately rather than silently ignored.

---

### blocker 2: rename to castFromDeclaredUnixHostAlias

**understood.**

created `src/domain.operations/hostAlias/castFromDeclaredUnixHostAlias.ts`:
```ts
export const castFromDeclaredUnixHostAlias = (input: {
  alias: DeclaredUnixHostAlias;
}): OsUnixHostsFileLine => { ... }
```

the naming follows the cast pattern: `castFrom[DomainType]` → `Os[Type]`

---

### blocker 3: create castIntoDeclaredUnixHostAlias

**understood.**

created `src/domain.operations/hostAlias/castIntoDeclaredUnixHostAlias.ts`:
```ts
export const castIntoDeclaredUnixHostAlias = (input: {
  line: OsUnixHostsFileLine;
  hostname: string;
}): DeclaredUnixHostAlias => { ... }
```

the inverse cast: `castInto[DomainType]` ← `Os[Type]`

---

### blocker 4: rename Entry to Line

**understood.**

`OsUnixHostsFileEntry` → `OsUnixHostsFileLine`

the term "line" is more intuitive for a hosts file representation.

---

### blocker 5: move to access/sdks/osUnixHostsFile

**understood.**

created `src/access/sdks/osUnixHostsFile/`:
```
├── dobj.OsUnixHostsFileLine.ts
├── dop.getOsUnixHostsFileLines.ts
├── dop.addOsUnixHostsFileLine.ts
└── index.ts
```

exports:
```ts
export { OsUnixHostsFileLine } from './dobj.OsUnixHostsFileLine';
export { getOsUnixHostsFileLines } from './dop.getOsUnixHostsFileLines';
export { addOsUnixHostsFileLine } from './dop.addOsUnixHostsFileLine';

export const osUnixHostsFileSdk = {
  getOsUnixHostsFileLines,
  addOsUnixHostsFileLine,
};
```

removed `adapter` directory from `src/domain.operations/hostAlias/`.

cast functions now live directly in `src/domain.operations/hostAlias/`:
- `castFromDeclaredUnixHostAlias.ts`
- `castIntoDeclaredUnixHostAlias.ts`

---

### blocker 6: apply same pattern to portAlias

**understood.**

created `src/access/sdks/osUnixSystemdSocat/`:
```
├── dobj.OsUnixSystemdSocatService.ts
├── dop.getOsUnixSystemdSocatServices.ts
├── dop.addOsUnixSystemdSocatService.ts
└── index.ts
```

exports:
```ts
export { OsUnixSystemdSocatService } from './dobj.OsUnixSystemdSocatService';
export { getOsUnixSystemdSocatServices } from './dop.getOsUnixSystemdSocatServices';
export { addOsUnixSystemdSocatService } from './dop.addOsUnixSystemdSocatService';

export const osUnixSystemdSocatSdk = {
  getOsUnixSystemdSocatServices,
  addOsUnixSystemdSocatService,
};
```

removed `adapter` directory from `src/domain.operations/portAlias/`.

cast functions now live directly in `src/domain.operations/portAlias/`:
- `castFromDeclaredUnixPortAlias.ts`
- `castIntoDeclaredUnixPortAlias.ts`

---

## confirmation

- [x] blocker 1: removed `stdout: 'ignore'` from `dop.addOsUnixHostsFileLine.ts:28` and `dop.addOsUnixSystemdSocatService.ts:38`
- [x] blocker 2: created `src/domain.operations/hostAlias/castFromDeclaredUnixHostAlias.ts`
- [x] blocker 3: created `src/domain.operations/hostAlias/castIntoDeclaredUnixHostAlias.ts`
- [x] blocker 4: renamed to `OsUnixHostsFileLine` in `src/access/sdks/osUnixHostsFile/dobj.OsUnixHostsFileLine.ts`
- [x] blocker 5: moved to `src/access/sdks/osUnixHostsFile/` with SDK pattern
- [x] blocker 6: moved to `src/access/sdks/osUnixSystemdSocat/` with SDK pattern
- [x] tests pass: 10 unit tests, 6 integration tests

---

## new directory structure

```
src/
├── access/
│   ├── daos/
│   │   ├── DeclaredUnixHostAliasDao.ts
│   │   └── DeclaredUnixPortAliasDao.ts
│   └── sdks/
│       ├── osUnixHostsFile/
│       │   ├── dobj.OsUnixHostsFileLine.ts
│       │   ├── dop.getOsUnixHostsFileLines.ts
│       │   ├── dop.addOsUnixHostsFileLine.ts
│       │   └── index.ts
│       └── osUnixSystemdSocat/
│           ├── dobj.OsUnixSystemdSocatService.ts
│           ├── dop.getOsUnixSystemdSocatServices.ts
│           ├── dop.addOsUnixSystemdSocatService.ts
│           └── index.ts
├── domain.objects/
│   ├── DeclaredUnixHostAlias.ts
│   ├── DeclaredUnixPortAlias.ts
│   └── ...
├── domain.operations/
│   ├── hostAlias/
│   │   ├── castFromDeclaredUnixHostAlias.ts
│   │   ├── castIntoDeclaredUnixHostAlias.ts
│   │   ├── getUnixHostAlias.ts
│   │   ├── getUnixHostAliases.ts
│   │   └── setUnixHostAlias.ts
│   └── portAlias/
│       ├── castFromDeclaredUnixPortAlias.ts
│       ├── castIntoDeclaredUnixPortAlias.ts
│       ├── getUnixPortAlias.ts
│       ├── getUnixPortAliases.ts
│       └── setUnixPortAlias.ts
└── contract/
    └── sdks/
        └── index.ts
```

the layer hierarchy is now:
- `access/sdks/*` = OS-level operations on raw resources (`OsUnix*`)
- `domain.operations/*` = domain-level operations with cast functions between layers
- `access/daos/*` = declastruct DAOs wrapping domain operations
