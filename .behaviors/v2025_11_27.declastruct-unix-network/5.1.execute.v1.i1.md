# execution progress: declastruct-unix-network

## status: complete ✅

---

## 1. domain objects ✅

created:
- `src/domain.objects/DeclaredUnixHostAlias.ts`
- `src/domain.objects/DeclaredUnixPortAlias.ts` (with `UnixPortEndpoint`)
- `src/domain.objects/ContextUnixNetwork.ts`
- `src/domain.objects/DeclastructUnixNetworkProvider.ts`

---

## 2. host alias operations ✅

created:
- `src/domain.operations/hostAlias/parseHostsFile.ts` — parsing and formatting helpers
- `src/domain.operations/hostAlias/readHostsFile.ts` — reads /etc/hosts
- `src/domain.operations/hostAlias/castToDeclaredUnixHostAlias.ts`
- `src/domain.operations/hostAlias/getHostAlias.ts`
- `src/domain.operations/hostAlias/getHostAliases.ts`
- `src/domain.operations/hostAlias/setHostAlias.ts`

---

## 3. host alias DAO ✅

created:
- `src/access/daos/DeclaredUnixHostAliasDao.ts`

---

## 4. port alias operations ✅

created:
- `src/domain.operations/portAlias/generateSocatServiceUnit.ts` — generates systemd unit file
- `src/domain.operations/portAlias/parseSocatServiceUnit.ts` — parses existing unit file
- `src/domain.operations/portAlias/castToDeclaredUnixPortAlias.ts`
- `src/domain.operations/portAlias/getPortAlias.ts`
- `src/domain.operations/portAlias/getPortAliases.ts`
- `src/domain.operations/portAlias/setPortAlias.ts`

---

## 5. port alias DAO ✅

created:
- `src/access/daos/DeclaredUnixPortAliasDao.ts`

---

## 6. provider ✅

created:
- `src/domain.operations/provider/getDeclastructUnixNetworkProvider.ts`

---

## 7. public SDK exports ✅

updated:
- `src/contract/sdks/index.ts` — exports provider, domain objects

---

## 8. validation ✅

- `npm run test:types` — passes
- `npm run build` — passes
- `npm run test:unit` — 47 tests pass
- `npm run test:integration` (hostAlias|portAlias) — 6 tests pass

---

## files created

```
src/
├── .test/assets/
│   └── getSampleUnixNetworkContext.ts
├── domain.objects/
│   ├── ContextUnixNetwork.ts
│   ├── DeclaredUnixHostAlias.ts
│   ├── DeclaredUnixPortAlias.ts
│   └── DeclastructUnixNetworkProvider.ts
├── domain.operations/
│   ├── hostAlias/
│   │   ├── castToDeclaredUnixHostAlias.ts
│   │   ├── getHostAlias.ts
│   │   ├── getHostAlias.integration.test.ts
│   │   ├── getHostAliases.ts
│   │   ├── getHostAliases.integration.test.ts
│   │   ├── parseHostsFile.ts
│   │   ├── parseHostsFile.test.ts
│   │   ├── readHostsFile.ts
│   │   ├── setHostAlias.ts
│   │   └── setHostAlias.test.ts
│   ├── portAlias/
│   │   ├── castToDeclaredUnixPortAlias.ts
│   │   ├── generateSocatServiceUnit.ts
│   │   ├── generateSocatServiceUnit.test.ts
│   │   ├── getPortAlias.ts
│   │   ├── getPortAlias.integration.test.ts
│   │   ├── getPortAliases.ts
│   │   ├── getPortAliases.integration.test.ts
│   │   ├── parseSocatServiceUnit.ts
│   │   ├── parseSocatServiceUnit.test.ts
│   │   ├── setPortAlias.ts
│   │   └── setPortAlias.test.ts
│   └── provider/
│       └── getDeclastructUnixNetworkProvider.ts
├── access/
│   └── daos/
│       ├── DeclaredUnixHostAliasDao.ts
│       └── DeclaredUnixPortAliasDao.ts
└── contract/
    └── sdks/
        ├── index.ts (updated)
        ├── declastruct.acceptance.test.ts (updated)
        └── .test/assets/resources.acceptance.ts (updated)
```

---

## usage

```ts
import {
  getDeclastructUnixNetworkProvider,
  DeclaredUnixHostAlias,
  DeclaredUnixPortAlias,
  UnixPortEndpoint,
} from 'declastruct-unix-network';

// get provider
const provider = getDeclastructUnixNetworkProvider({}, { log });

// declare host alias
const hostAlias = new DeclaredUnixHostAlias({
  via: '/etc/hosts',
  from: 'aws.ssmproxy.ahbodedb.prod',
  into: '127.0.0.1',
});

// declare port alias
const portAlias = new DeclaredUnixPortAlias({
  via: 'systemd-socat',
  from: new UnixPortEndpoint({ host: '127.0.0.1', port: 5433 }),
  into: new UnixPortEndpoint({ host: '127.0.0.1', port: 15433 }),
});

// set desired state (idempotent)
await provider.daos.DeclaredUnixHostAlias.set.upsert(hostAlias);
await provider.daos.DeclaredUnixPortAlias.set.upsert(portAlias);
```
